---
title: "Relação entre SAT e GPA"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(hrbrthemes)
theme_set(theme_ipsum_rc())

library(boot)
library(broom)
```


---

L4P1: Exercícios com inferência

---


---

1: Relação entre SAT e GPA
Nesse cenário, usaremos dados de resultados de duas avaliações feitas em alunos que se formaram em Computação em uma universidade pública americana. O primeiro é o SAT: "The SAT exam is a standardized test that most U.S. colleges use to determine whether students should be accepted into the institution."  e nossos dados tem a nota em matemática (math_SAT) e expressão verbal (verb_SAT) no SAT dos estudantes. A segunda nota disponível é a GPA dos alunos, que você pode interpretar como um agregado do desempenho deles no curso. Temos o GPA deles para as matérias de computação (comp_GPA) e no geral (univ_GPA).
Temos os dados de uma amostra de alunos de computação a partir da qual queremos generalizar afirmações para alunos de Computação em geral (ao menos dessa universidade). Nossas perguntas são: 
Como é a correlação entre o desempenho dos alunos em cada uma das dimensões do SAT (verbal e matemática) e seu desempenho nas matérias de computação do curso? 
Como se comparam entre si as correlações dos dois critérios do SAT com o desempenho nas matérias de Computação? Um dos critérios é claramente mais correlacionado com o desempenho nas matérias de computação que o outro? Os resultados apontam que essa diferença é grande? Pequena? 
O dados estão aqui. Esse notebook tem código que pode lhe ajudar. Faça clone do repositório e experimente com ele. As visualizações de ICs dele são um bom modelo para lhe inspirar.


kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk


1: Relação entre SAT e GPA
Nesse cenário, usaremos dados de resultados de duas avaliações feitas em alunos que se formaram em Computação em uma universidade pública americana. O primeiro é o SAT: "O exame SAT é um teste padronizado que a maioria das faculdades dos EUA usa para determinar se os alunos devem ser aceitos na instituição."  e nossos dados tem a nota em matemática (math_SAT) e expressão verbal (verb_SAT) no SAT dos estudantes. A segunda nota disponível é a GPA dos alunos, que você pode interpretar como um agregado do desempenho deles no curso. Temos o GPA deles para as matérias de computação (comp_GPA) e no geral (univ_GPA).
Temos os dados de uma amostra de alunos de computação a partir da qual queremos generalizar afirmações para alunos de Computação em geral (ao menos dessa universidade). Nossas perguntas são: 
Como é a correlação entre o desempenho dos alunos em cada uma das dimensões do SAT (verbal e matemática) e seu desempenho nas matérias de computação do curso? 
Como se comparam entre si as correlações dos dois critérios do SAT com o desempenho nas matérias de Computação? Um dos critérios é claramente mais correlacionado com o desempenho nas matérias de computação que o outro? Os resultados apontam que essa diferença é grande? Pequena? 
O dados estão aqui. Esse notebook tem código que pode lhe ajudar. Faça clone do repositório e experimente com ele. As visualizações de ICs dele são um bom modelo para lhe inspirar.


---

```{r}
binge = read_csv(here::here("data/young-people-drinking.csv"), 
                 col_types = "cdddddd")


dados = read_csv(here::here("data/sat-gpa.csv"), 
                 col_types = "dddd")

binge = binge %>% 
    mutate(sexo = if_else(sexo == "1", "M", "F"))

glimpse(dados)
glimpse(binge)
```


```{r}
s <- function(d, i) {
    sumarizado = d[i,] %>% 
        summarise(do_grupo = sum(sexo == "M") / n())
    
    sumarizado %>% 
      pull(do_grupo)
}

booted <- boot(data = filter(binge, mo_binge_n > 0), 
               statistic = s, 
               R = 2000)

estimado = tidy(booted, 
                conf.level = .95,
                conf.method = "basic",
                conf.int = TRUE)

glimpse(estimado)
```


```{r}
abusaram = nrow(filter(binge, mo_binge_n > 0))

estimado %>% 
    ggplot(aes(
        ymin = conf.low,
        y = statistic,
        ymax = conf.high,
        x = "Homens"
    )) +
    geom_linerange() +
    geom_point(color = "steelblue", size = 2) +
    geom_text(
        aes(
            y = conf.high,
            label = str_glue("[{round(conf.low, 2)}, {round(conf.high, 2)}]")
        ),
        size = 3,
        nudge_x = -.05,
        show.legend = F
    )  +
    scale_y_continuous(limits = c(0, 1)) +
    labs(
        title = "Proporção de homens entre participantes que abusaram de álcool",
        subtitle = str_glue("Estimado a partir de uma amostra de N={abusaram}"),
        x = "", y = "Proporção entre jovens que abusaram de álcool") +
    coord_flip()
```


```{r}
s <- function(d, i) {
    a = d[i,] %>% 
        filter(mo_binge_n == 0) %>% 
        summarise(do_grupo = mean(k_unit_sum)) %>% 
        pull(do_grupo)
    
    b = d[i,] %>% 
        filter(mo_binge_n > 0) %>% 
        summarise(do_grupo = mean(k_unit_sum)) %>% 
        pull(do_grupo)
    
    a - b
}

booted <- boot(data = binge, 
               statistic = s, 
               R = 2000)

estimado = tidy(booted, 
                conf.level = .95,
                conf.method = "bca",
                conf.int = TRUE)

glimpse(estimado)
```

```{r}
binge %>% 
    mutate(abusaram = if_else(mo_binge_n > 0, "Abusaram", "Não abusaram")) %>% 
    ggplot(aes(x = k_unit_sum, y = after_stat(density))) + 
    facet_wrap(~ abusaram) + 
    geom_histogram(fill = "steelblue", binwidth = 1, color = "black", alpha = .5) + 
    labs(
        y = "Porporção de participantes", 
        x = "Conhecimento sobre quantidades indicadas (0 a 6) "
    )
```

```{r}

total_linhas = binge %>% count()

#total_linhas = length(binge$sexo);
  
binge %>% 
    mutate(abusaram = if_else(mo_binge_n > 0, "Abusaram", "Não abusaram"), percentual = n()) %>% 
    group_by(abusaram) %>% 
    summarise(media = mean(k_unit_sum), n = n(), percentual = (n() / total_linhas$n) * 100, .groups = "drop")

```


```{r}
n_abusaram = nrow(filter(binge, mo_binge_n == 0))

estimado %>% 
    ggplot(aes(
        ymin = conf.low,
        y = statistic,
        ymax = conf.high,
        x = "Não abusaram - Abusaram"
    )) +
    geom_linerange() +
    geom_point(color = "steelblue", size = 3) +
    geom_text(
        aes(
            y = conf.high,
            label = str_glue("[{round(conf.low, 2)}, {round(conf.high, 2)}]")
        ),
        size = 3,
        nudge_x = -.05,
        show.legend = F
    )  +
    scale_y_continuous(limits = c(-3, 3)) +
    labs(
        title = "Diferença no conhecimento sobre quantidades indicadas",
        subtitle = str_glue("Na amostra de N={abusaram} que abusaram e N={n_abusaram} que não"),
        x = "", y = "Diferença no Conhecimento") +
    coord_flip()
```


